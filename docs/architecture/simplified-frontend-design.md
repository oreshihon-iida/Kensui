# Kensui アプリケーション 設計仕様書

## 1. アプリケーション概要
シンプルな懸垂記録アプリケーション

### 1.1 主な機能
- 懸垂回数の手動入力
- 日別合計回数の折れ線グラフ表示
- トレーニング履歴の記録

## 2. 技術スタック
- Flutter/Dart（クロスプラットフォーム開発）
- ローカルストレージ: SharedPreferences（外部サービス不使用）
- グラフ表示: fl_chart パッケージ（折れ線グラフ表示用）
- Material Design（UIコンポーネント）

### 2.1 開発アプローチ
- シンプルな機能から開始し、段階的に機能を追加
- ローカルストレージで完結する設計を優先
- 単一ユーザーを想定（認証機能なし）
- センサー機能（sensors_plusプラグイン）は将来のバージョンで実装

## 3. データモデル

### 3.1 トレーニング記録
```dart
class TrainingRecord {
  DateTime timestamp;  // 登録年月日時分（必須、JST）
  int repetitions;    // 回数（1以上の整数、必須）

  // バリデーションルール
  // - timestamp: 未来の日時は不可、JSTで保存
  // - repetitions: 1回以上、上限なし
}

class DailyTotal {
  DateTime date;      // 日付（DD形式、必須）
  int totalRepetitions;  // その日の合計回数（0以上の整数）
  int targetRepetitions; // 目標回数（達成時の合計数 + 5回）

  // 集計ルール
  // - 日付が同じTrainingRecordのrepetitionsを合算
  // - データが存在しない日は0として扱う
  // - 目標達成時に自動的に目標値を更新
}
```

## 4. 画面設計

### 4.1 メイン画面
- 回数入力フィールド（数値入力）
  - テンキーパッド形式の入力UI
  - 入力値の即時バリデーション
- 保存ボタン
- 日別合計回数の折れ線グラフ表示
  - X軸: 日付（DD形式）
  - Y軸: 合計回数と目標回数（2本線）
  - 表示期間選択
    - 直近1か月（デフォルト）
    - 直近3か月
    - 全期間
  - 目標達成時の即時フィードバック表示

### 4.2 履歴画面
- トレーニング記録一覧
  - 時刻の降順でソート（新しい記録が上に表示）
  - HH:MM n回 フォーマットで表示（JST）
  - リスト項目間の区切り線を追加
  - 記録なしの場合のメッセージを表示
- 各記録の編集・削除機能

## 5. データ永続化
- SharedPreferencesを使用したローカルストレージ
  - トレーニング記録の保存（JSONフォーマット）
  - アプリケーション設定の保存
  - 最後に表示した期間の記憶
- データバックアップ
  - ローカルファイルへのエクスポート機能
  - バックアップデータのインポート機能
- キャッシュ管理
  - 日別集計データのメモリキャッシュ
  - キャッシュの自動更新（新規データ追加時）
  - キャッシュのクリア機能

## 6. UI/UXガイドライン
- シンプルで直感的な数値入力
  - テンキーパッド形式の入力UI
  - 入力値の即時バリデーション
- グラフの視認性を重視したデザイン
  - 目盛りの適切な間隔
  - データポイントのタップ操作による詳細表示
- 明確な日付表示
  - 日本語の年月日表示
  - カレンダー形式での日付選択
- エラー処理
  - 無効な入力値の検証（0以下の値、文字列入力）
  - エラーメッセージの日本語表示
  - 入力修正のガイダンス表示

## 7. パフォーマンス最適化
- グラフデータの効率的な計算
  - 日別集計データのキャッシュ（DailyTotal）
  - バックグラウンドでの集計処理
  - 表示期間に応じたデータの間引き
- メモリ効率の良いデータ構造
  - 必要最小限のデータ保持
  - 古いデータの自動アーカイブ（6ヶ月以上前）
- スムーズなアニメーション
  - グラフ更新時の段階的な描画
  - ページ遷移時のスムーズな切り替え効果
  - 非同期データ読み込み時のスケルトン表示
